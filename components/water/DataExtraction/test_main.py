import os
from tempfile import TemporaryDirectory

import pytest
import pandas as pd

from main import data_extraction

input_data = pd.DataFrame(
    data={
        "DATE": [
            "1988-05-12",
            "1988-05-13",
            "1988-06-03",
            "1988-06-04",
            "1988-06-05",
            "1988-06-06",
            "1988-06-07",
            "1988-06-08",
            "1988-06-09",
            "1988-06-10",
            "1988-06-11",
            "1988-06-12",
            "1989-05-23",
            "1989-05-24",
            "1989-05-25",
            "1989-05-26",
            "1989-05-27",
            "1989-05-28",
            "1989-05-29",
            "1989-05-30",
        ],
        "CASTAÃ‘O DEL ROBLEDO": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            3.0,
            17.0,
            19.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            12.0,
            4.0,
        ],
        "JABUGO": [
            4.7,
            0.0,
            0.0,
            None,
            0.0,
            0.0,
            0.0,
            0.0,
            6.0,
            21.0,
            8.5,
            2.0,
            0.0,
            None,
            7.7,
            14.0,
            None,
            9.0,
            11.0,
            2.2,
        ],
        "GALAROZA": [
            7.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            4.0,
            4.5,
            15.0,
            21.0,
            0.0,
            1.7,
            0.0,
            21.3,
            3.6,
            12.0,
            3.7,
            29.2,
            3.2,
        ],
        "LA NAVA (LOS BATANES)": [
            None,
            None,
            None,
            None,
            None,
            None,
            None,
            11.0,
            2.0,
            10.0,
            19.0,
            None,
            0.0,
            10.0,
            None,
            4.0,
            11.0,
            3.0,
            8.0,
            None,
        ],
        "JABUGO, EL REPILADO": [
            None,
            None,
            None,
            0.0,
            None,
            None,
            0.0,
            8.0,
            5.7,
            7.2,
            4.5,
            4.5,
            0.0,
            1.0,
            13.6,
            2.8,
            7.2,
            4.0,
            32.2,
            0.7,
        ],
        "CUMBRES MAYORES": [
            None,
            None,
            None,
            None,
            None,
            None,
            None,
            8.0,
            5.7,
            7.2,
            4.5,
            4.5,
            0.0,
            1.0,
            13.6,
            2.8,
            7.2,
            4.0,
            32.2,
            0.7,
        ],
    }
)


def test_data_extraction():
    delimiter = ";"
    with TemporaryDirectory() as temp_dir:
        temp_input_file = os.path.join(temp_dir, "input_test.csv")
        temp_output_file = os.path.join(temp_dir, "output_test.csv")

        pd.DataFrame(input_data).to_csv(temp_input_file, index=False, sep=delimiter)

        data_extraction(
            filepath=temp_input_file,
            delimiter=delimiter,
            output=temp_output_file,
        )

        assert os.path.exists(temp_output_file)
        assert os.path.getsize(temp_output_file) > 0
