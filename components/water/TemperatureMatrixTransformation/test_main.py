import os
from tempfile import TemporaryDirectory

import pytest
import pandas as pd

from main import temperatureMatrixTransformation

input_data = pd.DataFrame(
    data={
        "INDICATIVO": [
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
            4514,
        ],
        "AÃ‘O": [1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1972],
        "MES": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
        "NOMBRE": [
            "JABUGO",
            "JABUGO",
            "JABUGO",
            "JAMON",
            "JABUGO",
            "JABUGO",
            "JAMON",
            "JAMON",
            "JABUGO",
            "JABUGO",
            "JABUGO",
            "JABUGO",
        ],
        "ALTITUD": [684, 684, 684, 684, 684, 684, 684, 684, 684, 684, 684, 684],
        "C_X": [
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
            172046,
        ],
        "C_Y": [
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
            4203292,
        ],
        "NOM_PROV": [
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
            "HUELVA",
        ],
        "LONGITUD": [
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
            643502,
        ],
        "LATITUD": [
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
            375505,
        ],
        "TMAX1": [200, 220, 180, 230, 210, 250, 270, 260, 240, 220, 200, 270],
        "TMAX2": [230, 250, 220, 240, 260, 280, 290, 310, 300, 280, 260, 330],
        "TMAX3": [150, 170, 180, 200, 210, 220, 230, 240, 250, 260, 270, 280],
        "TMAX4": [200, 250, 280, 220, 230, 250, 260, 280, 270, 260, 240, 230],
        "TMAX5": [280, 260, 240, 230, 220, 210, 200, 190, 180, 170, 160, 150],
        "TMAX6": [250, 240, 230, 220, 210, 200, 190, 180, 170, 160, 150, 140],
        "TMAX7": [170, 190, 210, 230, 240, 250, 270, 280, 290, 300, 280, 270],
        "TMAX8": [230, 260, 290, 250, 240, 230, 220, 210, 200, 190, 180, 200],
        "TMAX9": [180, 200, 220, 240, 260, 280, 290, 300, 310, 290, 280, 270],
        "TMAX10": [300, 280, 260, 240, 220, 200, 180, 160, 140, 120, 100, 80],
        "TMAX11": [100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320],
        "TMAX12": [200, 180, 160, 140, 120, 100, 150, 180, 200, 220, 250, 280],
        "TMAX13": [180, 200, 220, 240, 260, 280, 290, 300, 310, 300, 290, 280],
        "TMAX14": [140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360],
        "TMAX15": [160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380],
        "TMAX16": [220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440],
        "TMAX17": [160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380],
        "TMAX18": [180, 200, 220, 240, 260, 280, 290, 300, 310, 320, 330, 340],
        "TMAX19": [250, 270, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380],
        "TMAX20": [300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 500, 520],
        "TMAX21": [220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440],
        "TMAX22": [240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440, 460],
        "TMAX23": [270, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390],
        "TMAX24": [280, 300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 500],
        "TMAX25": [320, 340, 360, 380, 400, 420, 440, 460, 480, 500, 520, 540],
        "TMAX26": [300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 500, 520],
        "TMAX27": [280, 300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 500],
        "TMAX28": [180, 200, 220, 240, 260, 280, 290, 300, 310, 320, 330, 340],
        "TMAX29": [220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440],
        "TMAX30": [280, 300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 500],
        "TMAX31": [240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440, 460],
        "TMIN1": [100, 120, 80, 130, 110, 150, 170, 160, 140, 120, 100, 150],
        "TMIN2": [130, 150, 120, 140, 160, 180, 190, 210, 200, 180, 160, 180],
        "TMIN3": [80, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200],
        "TMIN4": [120, 140, 170, 120, 130, 150, 160, 180, 170, 160, 140, 130],
        "TMIN5": [180, 160, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50],
        "TMIN6": [150, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50, 40],
        "TMIN7": [100, 120, 140, 160, 170, 180, 200, 210, 220, 230, 210, 200],
        "TMIN8": [160, 180, 210, 150, 140, 130, 120, 110, 100, 90, 80, 100],
        "TMIN9": [110, 130, 150, 170, 190, 210, 220, 230, 240, 220, 210, 200],
        "TMIN10": [220, 200, 180, 160, 140, 120, 100, 80, 60, 40, 20, 0],
        "TMIN11": [0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200, 220],
        "TMIN12": [120, 100, 80, 60, 40, 20, 70, 100, 120, 140, 170, 200],
        "TMIN13": [100, 120, 140, 160, 180, 200, 210, 220, 230, 220, 210, 200],
        "TMIN14": [80, 100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300],
        "TMIN15": [100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320],
        "TMIN16": [160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380],
        "TMIN17": [90, 110, 130, 150, 170, 190, 210, 230, 250, 270, 290, 310],
        "TMIN18": [100, 120, 140, 160, 180, 200, 210, 220, 230, 240, 250, 260],
        "TMIN19": [150, 170, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280],
        "TMIN20": [200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420],
        "TMIN21": [120, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340],
        "TMIN22": [140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360],
        "TMIN23": [170, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290],
        "TMIN24": [180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400],
        "TMIN25": [220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440],
        "TMIN26": [200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420],
        "TMIN27": [180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400],
        "TMIN28": [100, 120, 140, 160, 180, 200, 210, 220, 230, 240, 250, 260],
        "TMIN29": [140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360],
        "TMIN30": [200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420],
        "TMIN31": [160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380],

    }
)


def test_temperature_matrix_transformation():
    delimiter = ";"
    with TemporaryDirectory() as temp_dir:
        temp_input_file = os.path.join(temp_dir, "input_test.xlsx")
        temp_output_min_file = os.path.join(temp_dir, "output_min_test.csv")
        temp_output_max_file = os.path.join(temp_dir, "output_max_test.csv")

        pd.DataFrame(input_data).to_excel(temp_input_file)

        temperatureMatrixTransformation(
            temp_input_file, temp_output_min_file, temp_output_max_file, delimiter
        )
        
        assert os.path.exists(temp_output_min_file)
        assert os.path.exists(temp_output_max_file)
        assert os.path.getsize(temp_output_min_file) > 0
        assert os.path.getsize(temp_output_max_file) > 0

if __name__ == "__main__":
    pytest.main()